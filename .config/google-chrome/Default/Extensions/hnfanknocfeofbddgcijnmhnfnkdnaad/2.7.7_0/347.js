"use strict";(self.webpackChunkcb_wallet_extension=self.webpackChunkcb_wallet_extension||[]).push([[347],{49347:(e,t,s)=>{s.r(t),s.d(t,{SignatureRequest:()=>H});var n=s(67294),a=s(25387),r=s(86896),i=s(22170),o=s(89756),c=s(28787),u=s(67051),l=s(16889),d=s(80493),g=s(47746),p=s(20258),f=s(3832),x=s(73107),b=s(79885);function m(){return(0,b.r)().filter((e=>f.$.isEqual(e.blockchain,x.t)))}var h,S=s(89201),y=s(47393),q=s(9943),k=s(6585),R=s(74673),w=s(23991),C=s(85893);function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var s=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==s)return;var n,a,r=[],i=!0,o=!1;try{for(s=s.call(e);!(i=(n=s.next()).done)&&(r.push(n.value),!t||r.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,n=new Array(t);s<t;s++)n[s]=e[s];return n}e=s.hmd(e),(h="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&h(e);var L="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},B="SignatureRequest",M=(0,a.vU)({signatureRequested:{id:"".concat(B,".signatureRequested"),defaultMessage:"Signature requested",description:"Signature Requested Label"},specialSignatureRequest:{id:"".concat(B,".specialSignatureRequest"),defaultMessage:"Special signature request",description:"Special signature request label"},specialSignatureDisclaimer:{id:"".concat(B,".specialSignatureDisclaimer"),defaultMessage:"This type of  request is sometimes used for malicious purposes. Only sign if you fully trust this site with access to your account",description:"Special signature disclaimer"},messageLabel:{id:"".concat(B,".messageLabel"),defaultMessage:"Message",description:"Message Label"},signButtonLabel:{id:"".concat(B,".signButtonLabel"),defaultMessage:"Sign",description:"Sign Button Label"},cancelButtonLabel:{id:"".concat(B,".cancelButtonLabel"),defaultMessage:"Cancel",description:"Cancel Button Label"}});function H(e){var t=e.options,s=(0,r.Z)().formatMessage,a=m(),u=(0,c.b)(),f=(0,o.$)(),x=j((0,n.useState)(""),2),b=x[0],h=x[1],v=t.request.params,L=v.message,B=v.addPrefix,H=v.typedDataJson,I=!B&&!H,T=new URL(t.dappURL).hostname;(0,n.useEffect)((function(){try{h((0,S.hexToString)(t.request.params.message))}catch(e){(0,l.c)("SignatureRequest: Could not convert hex to string",e),h(t.request.params.message)}}),[t.request.params.message]);var z=(0,n.useCallback)((function(e){u.completeSignMessage(t,e),u.hasNextQueuedRequest()?u.handleNextQueuedRequest():window.close()}),[u,t]),D=(0,n.useCallback)((function(){u.cancel(t.eventId),u.hasNextQueuedRequest()?u.handleNextQueuedRequest():window.close()}),[u,t.eventId]),O=(0,n.useCallback)((function(e){(0,l.c)(e),D()}),[D]),F=(0,n.useCallback)((function(e){var s,n=null!==(s=null==a?void 0:a.findIndex((function(e){return e.primaryAddress.toLowerCase()===t.request.params.address.toLowerCase()})))&&void 0!==s?s:-1;if(n<0)throw new Error("Failed to find ETH wallet.");p.P.ethCipherCore.getEthereumWalletKeyPair(BigInt(n),e.mnemonic).pipe((0,g.zg)((function(e){return p.P.ethCipherCore.signEthereumMessage((0,d.bufferFromHex)(L),e.privateKey,B)}))).subscribe(z,O)}),[a,t.request.params,z,O,L,B]),Q=(0,n.useCallback)((function(e){"SUCCESS"===e.status&&e.mnemonic?F(e):O(new Error("Unknown please try again"))}),[F,O]),W=(0,n.useCallback)((function(){f.unlock(i.tR.Transaction).subscribe(Q)}),[f,Q]);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(k.HStack,{spacingTop:3,spacingBottom:4,justifyContent:"center",alignItems:"center",position:"relative",children:(0,C.jsx)(k.Box,{position:"absolute",left:16,children:(0,C.jsx)(R.Pressable,{as:"button",onPress:D,backgroundColor:"transparent",children:(0,C.jsx)(q.Icon,{name:"close",size:"s",color:"foreground"})})})}),(0,C.jsxs)(k.VStack,{spacingHorizontal:3,children:[(0,C.jsx)("div",{className:N,children:(0,C.jsxs)(k.VStack,{children:[(0,C.jsx)("div",{className:P}),(0,C.jsx)(k.Box,{spacingBottom:2,flexGrow:1,justifyContent:"center",children:(0,C.jsx)("img",{alt:t.dappLogoURLAlt,src:t.dappLogoURL,className:A})}),(0,C.jsxs)(k.Box,{flexGrow:1,justifyContent:"center",children:[(0,C.jsx)(w.TextTitle3,{as:"p",children:s(I?M.specialSignatureRequest:M.signatureRequested)}),(0,C.jsx)(k.Box,{alignItems:"center",children:(0,C.jsx)(q.Icon,{spacingStart:1,name:"info",size:"xs",color:"foreground"})})]}),(0,C.jsx)(k.Box,{flexGrow:1,justifyContent:"center",spacingBottom:3,children:(0,C.jsx)(w.TextBody,{as:"p",color:"foregroundMuted",children:T})}),I&&(0,C.jsx)(k.Box,{dangerouslySetClassName:G,borderRadius:"standard",background:"negative",spacing:1,children:(0,C.jsxs)(k.HStack,{spacingHorizontal:1,alignItems:"center",children:[(0,C.jsx)(q.Icon,{spacingEnd:2,size:"s",name:"warning",color:"negative"}),(0,C.jsx)(w.TextLegal,{color:"negative",as:"p",children:s(M.specialSignatureDisclaimer)})]})}),(0,C.jsxs)(w.TextHeadline,{as:"p",spacingTop:10,spacingBottom:1,children:[s(M.messageLabel),":"]}),(0,C.jsx)(w.TextLabel2,{dangerouslySetClassName:E,as:"p",color:"foregroundMuted",children:b})]})}),(0,C.jsxs)(k.VStack,{gap:1,children:[I?(0,C.jsx)(U,{"data-testid":"sign-special-message",onClick:W,children:(0,C.jsx)(w.TextHeadline,{color:"primaryForeground",as:"p",spacing:2,children:s(M.signButtonLabel)})}):(0,C.jsx)(y.Button,{testID:"sign-message",onPress:W,block:!0,children:s(M.signButtonLabel)}),(0,C.jsx)(y.Button,{onPress:D,transparent:!0,block:!0,variant:"secondary",children:s(M.cancelButtonLabel)})]})]})]})}L(H,"useIntl{{\n    formatMessage\n  }}\nuseActiveEthBasedWallets{wallets}\nuseWeb3Manager{web3Manager}\nuseAppLockRepository{appLockRepository}\nuseState{[convertedMessage, setConvertedMessage]('')}\nuseEffect{}\nuseCallback{signSuccess}\nuseCallback{cancel}\nuseCallback{error}\nuseCallback{signAndSubmit}\nuseCallback{unlock}\nuseCallback{handleClickSign}",(function(){return[r.Z,m,c.b,o.$]}));var I,T,E="b174j4w6",G="din4m86",A="c1ysqala",N="s1c635uo",P="c1pucwfu",U=(0,u.Z)("button")({name:"RedButton",class:"rhy2au5"});s(23163),(I="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(I.register(B,"i18nKey","/workspaces/apps/extension/src/screens/SignatureRequest/SignatureRequest.tsx"),I.register(M,"messages","/workspaces/apps/extension/src/screens/SignatureRequest/SignatureRequest.tsx"),I.register(H,"SignatureRequest","/workspaces/apps/extension/src/screens/SignatureRequest/SignatureRequest.tsx"),I.register(E,"breakWord","/workspaces/apps/extension/src/screens/SignatureRequest/SignatureRequest.tsx"),I.register(G,"disclaimerBoxOpaqueBackground","/workspaces/apps/extension/src/screens/SignatureRequest/SignatureRequest.tsx"),I.register(A,"circleImage","/workspaces/apps/extension/src/screens/SignatureRequest/SignatureRequest.tsx"),I.register(N,"scrollableContainer","/workspaces/apps/extension/src/screens/SignatureRequest/SignatureRequest.tsx"),I.register(P,"containerGradientOverlay","/workspaces/apps/extension/src/screens/SignatureRequest/SignatureRequest.tsx"),I.register(U,"RedButton","/workspaces/apps/extension/src/screens/SignatureRequest/SignatureRequest.tsx")),(T="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&T(e)},23163:(e,t,s)=>{s.r(t)}}]);
//# sourceMappingURL=347.js.map