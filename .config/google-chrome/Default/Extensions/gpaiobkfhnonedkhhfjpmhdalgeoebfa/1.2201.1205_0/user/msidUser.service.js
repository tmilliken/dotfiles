!function(){"use strict";angular.module("app.user").service("msidUserService",["$log","$injector","constants",function(e,t,r){const n=r.USER_SERVICE_TYPE.MSID;var o=void 0;const i="email openid profile user.read",s="https://graph.microsoft.com/v1.0/me/",c=new URL("https://login.microsoftonline.com/common/oauth2/").toString(),a=new URL("https://login.live.com/oauth20_authorize.srf").toString(),u=new URL("nativeclient",c).toString(),f=new URL("v2.0/logoutsession",c).toString(),l=new URL("v2.0/authorize",c).toString(),p=(()=>{var e=new URL(l);return e.search=d({prompt:"select_account"}),e.toString()})(),m={};function h(){return o||(o=t.get("userService")),o}function d(e){const t={client_id:"1a20851a-696e-4c7e-96f4-c282dfe48872",response_type:"id_token token",redirect_uri:u,scope:i,response_mode:"fragment"};return new URLSearchParams(Object.assign({},t,e)).toString()}async function g(){var e={method:"GET",url:s,headers:{"X-UserType":n}},t={};try{t=function(e){for(const t in e)e.hasOwnProperty(t)&&t.match(/^@odata/i)&&delete e[t];return e}(await h().httpRequest(e))}catch(e){return Promise.reject("msidUser.fetchUserInfo failed: %s",e)}return t}return function(){m[r.MSACONFIG.ROAMING_SCOPE.toLowerCase()]=r.MSACONFIG.ROAMING_URL}(),{type:n,getConfig:function(){return{loginUrl:p,logoutUrl:f,aadPhotoUrl:r.O365CONFIG.PHOTO_URL,msaPhotoUrl:r.MSACONFIG.PHOTO_URL,userInfoUrl:s,documentsUrl:"https://graph.microsoft.com/v1.0/me/drive/recent"}},getResourceForEndpoint:function(t){if(!t)return i;const r={"https://graph.microsoft.com":{"/v1.0/me/":i,"/v1.0/me/drive/recent":"Files.ReadWrite.All"},"https://nleditor.osi.office.net":{"/NlEditor/":"https://nleditor.osi.office.net/NlEditor/instrumentation.write"},"https://consumer.suite.office.com":{"api/licensing/licensingdata":"https://consumer.suite.office.com/entitlements.read"},"https://webshell.suite.office.com":{"/api/shell/NewTab?culture=en-US":"https://webshell.suite.office.com/.default"}};try{const e=new URL(t);if(!r.hasOwnProperty(e.origin))return i;const o=r[e.origin],s=e.pathname;var n=Object.keys(o).reduce((e,t)=>s.startsWith(t)&&t.length>e.length?t:e);return o[n]}catch(t){return e.warning("msidUser.Service threw an exception: "+t),i}},lookupUserInfo:async function(e){const t=[g()];return(await Promise.all(t)).reduce((e,t)=>Object.assign(e,t))},requestAccessToken:async function(t,r,o){var i={scope:t,response_type:"token"};r&&r.email&&(i.login_hint=r.email);var s=d(i),c=new URL(o?a:l);c.search=s.toString();var u=await h().navigateToAuthEndpoint(c.href,n,!0);if(!u||!u.access_token){const r=u&&u.error,n=u&&u.error_description;return e.info(`failed to get token from iframe for resource ${t}, error: ${r}, description: ${n}`),Promise.reject("unable to retrieve result")}return u},getScopeEndpointMap:function(){return m},shouldGetUserInfo:function(e){if(!e.scope)return!1;const t=new Set(e.scope.split(" ").map(e=>e.toLowerCase().trim()));for(const e of i.split(" "))if(!t.has(e.toLowerCase().trim()))return!1;return!0}}}])}();