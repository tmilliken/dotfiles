!function(){"use strict";angular.module("app.user").factory("protectedResourceInterceptor",["$q","$log","$injector","constants",function(e,r,t,i){var n=t.get("userService");const o=t.get("editorUtils");return{request:function(t){var i=e.defer();if(Utilities.isUndefinedOrNull(t)||Utilities.isUndefinedOrNull(t.headers))return r.error(String.format("protectedResourceInterceptor.request: http request config is null or undefined")),i.resolve(t),i.promise;var o=t.headers["X-UserType"];if(Utilities.isUndefinedOrNull(o))return i.resolve(t),i.promise;var s=t.headers["X-Resource"];return delete t.headers["X-Resource"],delete t.headers["X-UserType"],n.acquireToken(o,t.url,s,!1).then(e=>{Utilities.isUndefinedOrNull(e)?r.warn(`failed to get auth token for type:${o}, resource ${s}`):t.headers.Authorization="Bearer "+e.access_token,i.resolve(t)}).catch(e=>{r.warn(`Error in getting auth token for type:${o}, resource ${s}`),i.reject(e)}),i.promise},responseError:async function(t){if(t&&401===t.status){if(Utilities.isNotUndefinedOrNull(t.config)&&(t.config.url===i.O365CONFIG.PHOTO_URL||t.config.url===i.MSACONFIG.PHOTO_URL||t.config.url===i.O365CONFIG.LICENSE_ENDPOINT||t.config.url===i.MSACONFIG.LICENSE_ENDPOINT))return e.reject(t);const s=await o.isFeatureFlagEnabled("enableRoamingService"),u=await n.isLoggedIn();s&&u&&r.error("user is unintentionally logged out"),await n.clearToken()}return e.reject(t)}}}])}();