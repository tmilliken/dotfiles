!function(){"use strict";angular.module("app.common").factory("editorUtils",["$q","$log","storage","constants",function(e,t,n,r){function o(e){if(!e)return{};try{var t=new URL(e),n={protocol:t.protocol,hostname:t.hostname};return n.hostname&&0!=n.hostname.length?n:{}}catch(e){return{}}}function a(e,t){if(e[t]){var n=JSON.parse(e[t]);if(void 0!==n.value)return JSON.parse(n.value)}}var i={getCurrentTabHostName:function(){var t=e.defer();return BrowserHandler.tabs.query({active:!0,currentWindow:!0},(function(e){if(e&&e[0]&&e[0].url){var n=e[0].url,r=o(n);"http:"===r.protocol||"https:"===r.protocol?t.resolve({url:n,hostname:r.hostname}):t.resolve({})}else t.resolve({})})),t.promise},siteHasNativeIntegration:function(e,t){return!(!e||!t)&&t.some((function(t){return new RegExp(t.replace("*",".*")).test(e)}))},siteIsBlocked:function(e){return Utilities.siteIsBlockedByManifest(e)},openOptionsPage:function(){window.open(BrowserHandler.extension.getURL("options.html"),"_blank")},getHostnameOnlyUrl:function(e){var t=o(e);if(t.protocol)return t.protocol+"//"+t.hostname},getFormattedLocalizedString:function(e,t){return BrowserHandler.i18n.getMessage(e,t)},isHostNameExcluded:function(e,t){return!(!t||!t.find((function(t){try{return i.getUrlInfo(t).hostname===e}catch(e){return!1}})))},isUrlExcluded:function(e,t){return!(!t||!t.find((function(t){try{return new RegExp(t).test(e)}catch(e){return!1}})))},sendEditorPrioritySignal:function(){r.OFFICEBX.ID_LIST.forEach((function(e,t){BrowserHandler.runtime.sendMessage(e,{command:r.OFFICEBX.CMD_DISABLE},e=>{BrowserHandler.runtime.lastError})}))},isFeatureFlagEnabled:async function(e){const t=a(await n.get("featureFlags"),"featureFlags");return!(!t||void 0===t[e])&&("string"==typeof t[e]?"true"===t[e].toLowerCase():t[e])},addEditorPriorityListener:function(){BrowserHandler.runtime.onMessageExternal.addListener((e,t,n)=>{r.OFFICEBX.ID_LIST.indexOf(t.id)>=0&&e.command===r.OFFICEBX.CMD_CHECK&&n({command:r.OFFICEBX.CMD_DISABLE})})},getUrlInfo:o,readSettingValueOrUndefined:a,writeEditorSettingValue:function(e,t){var r={value:JSON.stringify(t),lastUpdated:Date.now(),manualOverride:!1},o={};o[e]=JSON.stringify(r),n.set(o)}};return i}])}();