"use strict";const isIFrame=window.parent!==window;function log(t){const o=(()=>{const t=(new Error).stack.split("\n");if(t.length<4)return;return t[3].match(/\b[\w\.]+\b:\d+/g).pop()})();chrome.runtime.sendMessage({activity:"log",log:`${isIFrame?"(iframe)":""}${o||""}: ${t}`})}function notifyAuthentication(t,o){const n={activity:"authorization",origin:window.location.origin,close:!0,eventId:"authorization",data:[{address:void 0}]};Object.assign(n,o),location.hash="",BrowserHandler.runtime.sendMessage(n),log(`auth notification type:${t} state:${o.state} scope:${o.scope}`)}function isResponse(){return location.hash.length>0}function parseParams(t){const o=t.split(/[?#]/);if(o.length<2)return{};t=o[1];const n=new URLSearchParams(t),i={};for(const[t,o]of n.entries())i[t]=o;return i}log("navigated to: "+location.href),window.addEventListener("load",()=>{const t=parseParams(location.href);t.state&&t.state.includes("EditorExtension")&&("https://login.microsoftonline.com"===window.location.origin?t.code?notifyAuthentication("o365UserService",t):isResponse()&&"/common/oauth2/nativeclient"===location.pathname&&notifyAuthentication("msidUserService",t):"https://login.live.com"===window.location.origin&&(t.code?notifyAuthentication("msaUserService",t):"/oauth20_authorize"===location.pathname&&notifyAuthentication("msidUserService",t)))});