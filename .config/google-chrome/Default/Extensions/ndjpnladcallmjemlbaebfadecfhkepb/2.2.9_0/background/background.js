!function(e){function t(t){for(var n,a,s=t[0],c=t[1],u=t[2],d=0,f=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&f.push(i[a][0]),i[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(l&&l(t);f.length;)f.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,s=1;s<r.length;s++){var c=r[s];0!==i[c]&&(n=!1)}n&&(o.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},i={2:0},o=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;o.push([55,0]),r()}({0:function(e,t,r){"use strict";var n=r(5);t.a={IDTYPE:{MSACID:"MSACID",ORGIDPUID:"OrgIdPUID"},ACTIVITY:{AUTHENTICATION:{NAME:"authentication"},AUTHORIZATION:{NAME:"authorization"},NOTIFICATION:{NAME:"notification"},TELEMETRY:{NAME:"telemetry"},USERINFO_AVAILABLE:{NAME:"userInfoAvailable"},SSO:{NAME:"sso"},LOGOUT:{NAME:"logout"},REQUEST_TOKEN:{NAME:"requestToken"},LOG:{NAME:"log"}},APPINFO_NAME:"OfficeOnlineExtension",FILE:{APPLICATION_IMAGE_PATH:{excel:"assets/excel_doc.png",onenote:"assets/onenote_doc.png",powerpoint:"assets/powerpoint_doc.png",unknown:"assets/generic_doc.png",word:"assets/word_doc.png"},APPLICATION_LABEL:{excel:"ExcelOnlineAppName",onenote:"OneNoteOnlineAppName",powerpoint:"PowerPointOnlineAppName",unknown:"OfficeOnlineAppName",word:"WordOnlineAppName"},ERROR:{FILE_SIZE_MAX_EXCEEDED:"fileSizeMaxExceeded",LOAD_FROM_PATH:"loadFromPath",UNSUPPORTED_FILE_TYPE:"unsupportedFileType"},MAX_SIZE_BYTE_LIMIT:4194304,OFFICE_APP_FILE_ASSOCIATIONS:{EXCEL:"excel",ONENOTE:"onenote",POWERPOINT:"powerpoint",WORD:"word"},OFFICE_MIME_TYPES:{"application/msword":"word","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"word","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"word","application/vnd.oasis.opendocument.text":"word","application/vnd.ms-powerpoint":"powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation":"powerpoint","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"powerpoint","application/vnd.oasis.opendocument.presentation":"powerpoint","application/vnd.ms-excel":"excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"excel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"excel","application/vnd.ms-excel.sheet.macroEnabled.12":"excel","application/vnd.oasis.opendocument.spreadsheet":"excel"},ORIGIN:{HTML5:"html5",LOCAL_PATH:"local_path"},SUPPORTED_APPLICATIONS:["Word","Excel","PowerPoint","OneNote"],SUPPORTED_FILE_TYPES:{doc:"word",dot:"word",docx:"word",dotx:"word",odt:"word",ppt:"powerpoint",pot:"powerpoint",pps:"powerpoint",pptx:"powerpoint",ppsx:"powerpoint",odp:"powerpoint",xlsx:"excel",xlsm:"excel",xlsb:"excel",ods:"excel",notebook:"onenote"}},JQUERY:{EVENT_ID:{KEYPRESS:{ENTER:13,ARROWLEFT:37,ARROWUP:38,ARROWRIGHT:39,ARROWDOWN:40},MOUSEDOWN:{LEFT_BUTTON_CLICK:1}}},LINKS:{OFFICE_URL:"https://portal.office.com/home",PROGRESSPAGE_URL:"https://onedrive.live.com",SETTINGS_URL:"chrome://extensions",SIGNUP:"https://onedrive.live.com/about",UNINSTALL:"https://contentstorage.osi.office.net/officeonlineextensionuninstall/uninstall.html",OFFICE_HOME_URL:"https://go.microsoft.com/fwlink/?linkid=859986",OFFICE_HOME_DEV_URL:"https://go.microsoft.com/fwlink/?linkid=860665",SUPPORT_URL:"https://aka.ms/officeextsignin",SUPPORT_URL_EDITOR:"https://aka.ms/OfficeEditorExtension",MYACCOUNT_MSA_URL:"https://go.microsoft.com/fwlink/?LinkId=823747",MYACCOUNT_O365_URL:"https://go.microsoft.com/fwlink/?LinkId=824642",APP:{WORD:function(){return`https://office.live.com/start/word.aspx?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},EXCEL:function(){return`https://office.live.com/start/excel.aspx?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},POWERPOINT:function(){return`https://office.live.com/start/powerpoint.aspx?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},ONENOTE:function(){return`https://www.onenote.com/notebooks?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},SWAY:function(){return`https://www.sway.com/?auth_pvr=${arguments[0]}&auth_upn=${arguments[1]}&WT.mc_id=Chrome_OfficeApp`},SWAY_DEFAULT:"https://www.sway.com/?WT.mc_id=Chrome_OfficeApp",ONEDRIVE:"https://onedrive.live.com",TEAMS:"https://teams.microsoft.com",SHAREPOINT_DEFAULT:"https://products.office.com/sharepoint",OUTLOOK_DEFAULT:"https://outlook.com",OUTLOOK_O365:"https://outlook.office365.com"}},MENU_VIEWMODE:{NONE:0,NEW:1,OPEN:2,ACCOUNT:3,SETTINGS:4},OAUTH:{ACCESS_TOKEN:"access_token",AUTH_CODE:"authorization_code",CODE:"code",EXPIRES_ON:"expires_on",REFRESH_TOKEN:"refresh_token",SERVICE_ENDPOINT:"service_endpoint",SERVICE_ID:"service_id"},O365CONFIG:{CLIENT_ID:"d08f258a-c5dd-4a8f-8afc-9321d67c767a",CLIENT_SECRET:"4C3JSV:94f_WBYDF+RkH@TX9QhIrzijR",GRAPH_RESOURCE:"https://graph.microsoft.com",ENDPOINTS:{"officeapps.live.com":"https://officeapps.live.com","graph.microsoft.com":"https://graph.microsoft.com"},INSTANCE:"https://login.windows.net/common/oauth2/",LOGOUT_URI:"https://login.microsoftonline.com/logout.srf",MRU_URL:"https://ocws.officeapps.live.com/ocs/docs/recent/",PHOTO_URL:"https://graph.microsoft.com/v1.0/me/photo/$value",ONEDRIVE_URL:"https://graph.microsoft.com/v1.0/me/drive/root",SHAREPOINT_URL:"https://graph.microsoft.com/v1.0/sites/root",REDIRECT_URI:"https://login.microsoftonline.com/login.srf",UPLOAD_URL:"https://graph.microsoft.com/v1.0/me/drive/root:/",FEDERATED_URL:"https://login.microsoftonline.com/getuserrealm.srf"},MSACONFIG:{CLIENT_ID:"000000004016DA34",CLIENT_SECRET:"qXom9iuDN8qMUKe5oU6DHrRxS8bikLrI",INSTANCE:"https://login.live.com/oauth20_authorize.srf",LOGOUT_URI:"https://login.live.com/oauth20_logout.srf",ONEDRIVE_ITEMS_URL:"https://api.onedrive.com/v1.0/drive/items/",PHOTO_URL:"https://apis.live.net/v5.0/me/picture",REDIRECT_URI:"https://login.live.com/oauth20_desktop.srf",SCOPE:"wl.basic+wl.emails+wl.signin+wl.offline_access+onedrive.readwrite+wl.skydrive",URL:"https://login.live.com/oauth20_token.srf",USERINFO_URL:"https://apis.live.net/v5.0/me"},NOTIFICATION:{FILEACCESS:{id:"fileAccess",priority:0,type:"basic",message:"NotificationFileAccess"},FILE_MAX_SIZE_BYTE_LIMIT_REACHED:{id:"fileMaxSizeByteLimitReached",priority:2,type:"basic",message:"NotificationFileMaxSizeByteLimitReached"},FILE_UPLOAD_FAILURE_GENERIC:{id:"fileUploadFailureGeneric",priority:2,type:"basic",message:"NotificationFileUploadFailureGeneric"},FILE_UPLOAD_FAILURE_SERVER:{id:"fileUploadFailureServer",priority:2,type:"basic",message:"NotificationFileUploadFailureServer"},FILE_UPLOAD_FAILURE_UNSUPPORTED_MEDIA:{id:"fileUploadFailureUnsupportedMedia",priority:2,type:"basic",message:"NotificationFileUploadFailureUnsupportedMedia"},FILE_UPLOAD_IN_PROGRESS:{id:"fileUploadInProgress",priority:0,type:"basic",message:"NotificationFileUploadInProgress"},SETDEFAULT:{id:"setDefault",priority:0,type:"basic",message:"NotificationSetDefault"},AUTOSAVE:{id:"autoSave",priority:0,type:"basic",buttons:[{title:"NotificationAutoSaveButton"}]},AUTOSAVETOONEDRIVE:"NotificationAutoSaveToOneDrive",AUTOSAVETOSHAREPOINT:"NotificationAutoSaveToSharePoint",NOTSIGNEDIN:{id:"notSignedIn",priority:2,type:"basic",message:"NotificationNotSignedIn"},UNSUPPORTEDFILETYPE:{id:"unsupportedFileType",priority:2,type:"basic",message:"NotificationUnsupportedFileType"},INVALIDSUBSCRIPTION:{id:"invalidSubscription",priority:2,type:"basic",message:"NotificationInvalidSubscription"},WEBDOCREDIRECT:{id:"webDocRedirect",priority:0,type:"basic",message:"NotificationWebDocRedirect",buttons:[{title:"NotificationWebDocRedirectButton"}]}},ONEDRIVE:{DISPLAY_URL:"https://onedrive.live.com/view.aspx?cid=",INSTANCE:"https://api.onedrive.com/v1.0",QUERY_OPTION:"?@name.conflictBehavior=rename"},RECENTS:{LIST_LENGTH_MSA:3,LIST_LENGTH_O365:3,FILTER:"?apps=powerpoint,word,excel,onenote&sort=date",ONEDRIVE_ENDPOINT:"https://api.onedrive.com/v2.1/drive/recent",DISPLAY_PANEL:{ERROR:0,LIST:1,LOADING:2,NO_DOCS:3,NONE:4},ERROR:{CANCELLED:0,GENERIC:1,NO_DOCS_FOUND:2,UNSUPPORTED_USER_TYPE:3}},SIGNINSTATUS:{UNKNOWN:-1,NONE:0,HASREFRESHTOKEN:1,SIGNEDIN:2},TELEMETRY:{COMMAND:{SET_DISABLED:"setDisabledTelemetry",TRACK_TRACE:"trackTrace",TRACK_EVENT:"trackEvent"},ENABLED_SETTING_STORAGE_KEY:"telemetry_enabled",EVENT_PREFIX:"OO_CHROME_",PII_TYPE:{IDENTITY:10}},USER_TYPE:{MSA:"msa",O365:"aad",NONE:"none"},USER_SERVICE_TYPE:{MSA:"msaUserService",O365:"o365UserService",MSID:"msidUserService",NONE:"noneUserService"},TIMEOUT:{DEFAULT_REQUEST:1e4,USER_INFO_LOOKUP:5e3,USER_INFO_LOOKUP_TEST:50},COPY_PASTE:{TEST:n.a.testCommand,PASTE:n.a.pasteCommand,GET_CLIPBOARD_DATA:n.a.getClipboardDataCommand,GET_AVAILABLE_COMMANDS:n.a.getAvailableCommandsCommand},ERROR_RETRIES:{HTTP_REQUEST:3},BROWSER_ICON:{DEFAULT:"../assets/icon_20.png",INACTIVE:"../assets/icon_inactive_20.png"},SSO:{MESSAGE_CHANNEL:"com.microsoft.browsercore",RESPONSE_STATUS_SUCCESS:"Success",RESPONSE_STATUS_FAIL:"Fail",RESPONSE_CODE_NO_SUPPORT:"NoSupport",RESPONSE_CODE_INVALID:-2147186943}}},1:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2);window.Utilities||(window.Utilities={deserializeQuery:function(e){var t,r=/\+/g,n=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(r," "))},o={};for(t=n.exec(e);t;)o[i(t[1])]=i(t[2]),t=n.exec(e);return o},getFileExtension:function(e){var t="";if(e){var r=e.match(/(?:\.)(\w+)$/);r&&r.length>1&&(t=r[r.length-1].toLowerCase())}return t},navigateToUrlWithNewTab:function(e,t){n.default.tabs.create({url:e,active:!!this.isUndefinedOrNull(t)||t})},isNotUndefinedOrNull:function(e){return!this.isUndefinedOrNull(e)},isUndefinedOrNull:function(e){return null==e},isExtensionInTestingMode:function(){return this.isNotUndefinedOrNull(window.jasmine)},isExtensionInDevelopmentMode:function(){if(this.isExtensionInTestingMode())return!1;if(window.browser&&window.browser.extension){var e=n.default.runtime.getURL("");if(null!=e&&/_microsoftofficeonline_/i.test(e))return!1}if(window.chrome&&window.chrome.extension){var t=this.getManifest();if(null==t)return!1;if(void 0!==t.key||void 0!==t.update_url)return!1}return!0},isEditorEnabled:function(){if(!window.chrome||!window.chrome.extension)return!1;var e=this.getManifest();return e&&e.background&&e.background.scripts&&e.background.scripts.includes("editor/background.js")},shouldShowEditorMaterial:function(){if(!window.chrome||!window.chrome.extension)return!1;var e=this.getManifest();return e&&e.version_name&&-1!=e.version_name.indexOf("[ed]")},getAppDescription:function(){if(window.chrome&&window.chrome.extension)return this.getManifest().description},getManifest:function(){if("object"!=typeof n.default.runtime||"function"!=typeof n.default.runtime.getManifest)return null;var e=n.default.runtime.getManifest();return null==e?null:e},isBackgroundContext:function(){var e=window.location.href;return!!(window.browser&&window.browser.extension&&/^ms-browser-extension/.test(e)&&window===n.default.extension.getBackgroundPage())||!!(window.chrome&&window.chrome.extension&&/^chrome/.test(e)&&window===n.default.extension.getBackgroundPage())},getCurrentTime:function(){return Math.round((new Date).getTime()/1e3)},isChrome:function(){return"Chrome"===this.getBrowserName()&&window.navigator.vendor.indexOf("Google")>-1},getBrowserAndVersion:function(){if(!this.browserVersion){const e=e=>{const t=new RegExp(`(?<browser>${e})/(?<version>[0-9.]+)`,"i"),r=window.navigator.userAgent.match(t);if(r&&r.groups)return r.groups;if(window.navigator.userAgentData){const t=window.navigator.userAgentData.brands.find(t=>t.brand.match(new RegExp(e,"i")));if(t)return{browser:t.brand,version:t.version}}},t=["OPe?R","Edge?","Chrome","Safari","Firefox"];for(const r of t){const t=e(r);if(t){this.browserVersion=t;break}}}return this.browserVersion},getBrowserName:function(){const e=this.getBrowserAndVersion();return e?e.browser:"Chrome"},isRTL:function(){var e=n.default.i18n.getUILanguage();return!!(/^ar/i.test(e)||/^fa/i.test(e)||/^he/i.test(e))},setIcon:function(e){n.default.browserAction.setIcon({path:e})}}),t.default=window.Utilities},14:function(e,t,r){"use strict";var n=r(3),i=r.n(n),o=r(1),a=r.n(o),s=r(2),c=r.n(s),u=r(0),l=r(4);i.a.module("app.diagnostics",[]).service("telemetry",["$injector","ariaTelemetry",function(e,t){var r=[t],n=async function(t){var r=e.get("userService");a.a.isUndefinedOrNull(t)&&(t={}),t.pii=[];var n=a.a.getManifest();n&&(t.appVersion=n.version);var i=c.a.i18n.getUILanguage();a.a.isNotUndefinedOrNull(i)&&(t.language=i),t["AppInfo.Name"]=u.a.APPINFO_NAME;var o=await r.getUserType(),s=l.AWTLogManager.getSemanticContext();if(o===u.a.USER_TYPE.NONE)return s.setUserId("","",""),t;var d=await r.getUserInfo(o);return a.a.isUndefinedOrNull(d)?(s.setUserId("","",""),t):(a.a.isNotUndefinedOrNull(d.cid)&&(t.cid=d.cid,s.setUserId(d.cid),t["UserInfo.IdType"]=u.a.IDTYPE.MSACID),a.a.isNotUndefinedOrNull(d.features)&&(t.experimentFeatures=d.features),a.a.isNotUndefinedOrNull(d.puid)&&(t.pii.push({type:u.a.TELEMETRY.PII_TYPE.IDENTITY,name:"puid",value:d.puid}),s.setUserId(d.puid),t["UserInfo.IdType"]=u.a.IDTYPE.ORGIDPUID),a.a.isNotUndefinedOrNull(d.tid)&&(t["UserInfo.OMSTenantId"]=d.tid),t)},o=function(){var t=e.get("$q"),r=e.get("storage"),n=t.defer();return r.get(["telemetry_enabled","enableTelemetry"]).then((function(e){n.resolve(!(!a.a.isUndefinedOrNull(e)&&!0!==function(e,t){if(e[t]){var r=JSON.parse(e[t]);if(void 0!==r.value)return JSON.parse(r.value)}}(e,"enableTelemetry")&&!a.a.isUndefinedOrNull(e.telemetry_enabled)&&!0!==e.telemetry_enabled))})),n.promise};return{getEnabledSetting:function(){return o()},setEnabledSetting:function(t){if(a.a.isBackgroundContext()){!function(t){e.get("storage").set({telemetry_enabled:t,enableTelemetry:JSON.stringify({value:JSON.stringify(t),lastUpdate:Date.now(),manualOverride:!1})})}(t);for(var n=0;n<r.length;++n)r[n].setEnabledSetting(t)}else c.a.runtime.sendMessage({activity:u.a.ACTIVITY.TELEMETRY.NAME,command:u.a.TELEMETRY.COMMAND.SET_DISABLED,enabled:t})},trackEvent:async function(e,t,o){if(!i.a.isUndefined(e)&&i.a.isString(e))if(a.a.isBackgroundContext()){t=await n(t);for(var s=0;s<r.length;++s){var l=i.a.extend({},t);r[s].trackEvent(e,l,o)}}else c.a.runtime.sendMessage({activity:u.a.ACTIVITY.TELEMETRY.NAME,command:u.a.TELEMETRY.COMMAND.TRACK_EVENT,eventName:e,properties:t,measurements:o})},trackTrace:async function(e,t){if(!i.a.isUndefined(e)&&i.a.isString(e))if(a.a.isBackgroundContext()){t=await n(t);for(var o=0;o<r.length;++o){var s=i.a.extend({},t);r[o].trackTrace(e,s)}}else c.a.runtime.sendMessage({activity:u.a.ACTIVITY.TELEMETRY.NAME,command:u.a.TELEMETRY.COMMAND.TRACK_TRACE,message:e,properties:t})}}}]).service("ariaTelemetry",["$window",function(e){var t=function(e,t){if(!a.a.isUndefinedOrNull(e)&&!a.a.isUndefinedOrNull(t)){if(!a.a.isUndefinedOrNull(t.pii)){for(var r=0;r<=t.pii.length-1;++r)e.setProperty(t.pii[r].name,t.pii[r].value,t.pii[r].type);delete t.pii}for(var n in t)t.hasOwnProperty(n)&&e.setProperty(n,t[n])}},r=!0;this.setEnabledSetting=function(e){r=e},this.trackEvent=function(n,i,o){if(r){n=n.replace(/\./g,"_");var a=new l.AWTEventProperties;a.setName(u.a.TELEMETRY.EVENT_PREFIX+n),t(a,i),t(a,o),e.ariaLogger.logEvent(a)}},this.trackTrace=function(n,i){if(r){var o=new l.AWTEventProperties;o.setName(u.a.TELEMETRY.EVENT_PREFIX+n),o.setProperty("severity",n),t(o,i),e.ariaLogger.logEvent(o)}}}]).name},17:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=r(2);function o(e){return function(...t){return new Promise((r,n)=>{t.push((function(...e){return r(...e)})),e.call(this,...t)})}}function a(e,t=null){return Array.isArray(e)||(e=[e]),new Promise((r,a)=>n(this,void 0,void 0,(function*(){var a,s;try{var c=yield function(e){return n(this,void 0,void 0,(function*(){Array.isArray(e)||(e=[e]);var t=yield o(i.default.permissions.getAll)();return console.debug("permissions granted: "+JSON.stringify(t)),e.filter(e=>!t.permissions.includes(e))}))}(e);if(!c.length)return r(!0);var u=yield o(i.default.permissions.contains)({permissions:c});if(console.debug(`Granted permissions ${!0===u?"":"do not"} include ${c}`),u)return r(u);var l=yield o(i.default.permissions.request)({permissions:c});console.debug(`Requested permissions ${c} ${l?"granted":"denied"}`);var d={granted:!!l,permissions:c};return!l&&i.default.runtime&&(d.lastError=null===(a=i.default.runtime.lastError)||void 0===a?void 0:a.message,d.id=i.default.runtime.id),null===(s=t)||void 0===s||s.trackEvent("Permission",d),r(!!l)}catch(e){r(!1)}})))}t.checkPermission=a,t.preemptivePermissionsRequest=function(){return n(this,void 0,void 0,(function*(){try{var e=i.default.runtime.getManifest().optional_permissions;yield a(e)}catch(e){console.log("preemptivePermissionsRequest exception:"+e)}}))}},2:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=[],i={};t.default=function(){var e=(()=>{if("object"==typeof browser){var e=Object.create(browser);e.notifications={clear:function(e,t){t(!1)},create:function(e,t,r){null!=t&&void 0!==t.priority&&null!==t.priority&&t.priority>0&&window.alert(t.message),r(e)},onButtonClicked:{addListener:function(e){}},onClicked:{addListener:function(e){}}},e.runtime={getPlatformInfo:function(e){}}}else if("object"==typeof chrome)return Object.create(chrome)})();if(window.jasmine){e=function e(t,r){for(const[n,i]of Object.entries(r))t[n]?typeof i==typeof t[n]?Array.isArray(i)?t[n]=t[n].concat(i):t[n]="object"!=typeof i?i:e(t[n],i):console.log(`skipping ${n} due to conflicting types`):t[n]=i;return t}(e||{},{mock:!0,browserAction:{setIcon:function(e){}},extension:{getURL:function(e){return""}},i18n:{getUILanguage:function(e,t){return""},getMessage:function(){return""}},runtime:{onMessage:{addListener:function(e){n.push(e)},removeListener:function(e){n.splice(n.indexOf(e),1)}},sendMessage:function(e){for(let t=0;t<n.length;++t)n[t](e)},id:"ndjpnladcallmjemlbaebfadecfhkepb"},storage:{local:{get:function(e,t){t({[e]:i[e]})},set:function(e){for(const t in e)e.hasOwnProperty(t)&&(i[t]=e[t])},remove:function(e,t){delete i[e],t(i)},clear:function(e,t){i={}}}},tabs:{create:function(e,t){t&&t({})}}}),window.chrome||(window.chrome=e)}return window.BrowserHandler||(window.BrowserHandler=e),e}()},24:function(e,t,r){"use strict";var n=r(3),i=r.n(n),o=r(1),a=r.n(o),s=r(2),c=r.n(s),u=r(0);r(7),i.a.module("app.user",[]).config(["$httpProvider","$provide",function(e,t){e.interceptors.push("protectedResourceInterceptor")}]).factory("protectedResourceInterceptor",["$q","$log","$injector",function(e,t,r){var n=r.get("userService");return{request:function(r){var i=e.defer();if(a.a.isUndefinedOrNull(r)||a.a.isUndefinedOrNull(r.headers))return t.error("protectedResourceInterceptor.request: http request config is null or undefined"),i.resolve(r),i.promise;var o=r.headers["X-UserType"];if(a.a.isUndefinedOrNull(o))return i.resolve(r),i.promise;var s=r.headers["X-Resource"];return delete r.headers["X-Resource"],delete r.headers["X-UserType"],n.acquireToken(o,r.url,s).then(e=>{a.a.isUndefinedOrNull(e)?t.warn(`failed to get auth token for type:${o} url: ${r.url}, resource ${s}`):r.headers.Authorization="Bearer "+e,i.resolve(r)}),i.promise},responseError:function(t){if(t&&401===t.status){if(a.a.isNotUndefinedOrNull(t.config)&&(t.config.url===u.a.O365CONFIG.SHAREPOINT_URL||t.config.url===u.a.O365CONFIG.PHOTO_URL))return e.reject(t);n.clearToken()}return e.reject(t)}}}]).service("msaUserService",["$log","$injector",function(e,t){this.type=u.a.USER_TYPE.MSA,this.type=u.a.USER_SERVICE_TYPE.MSA,this.userType=u.a.USER_TYPE.MSA,this.getConfig=function(){return{tokenUrl:u.a.MSACONFIG.URL,params:{client_id:u.a.MSACONFIG.CLIENT_ID,client_secret:u.a.MSACONFIG.CLIENT_SECRET,redirect_uri:u.a.MSACONFIG.REDIRECT_URI},resource:u.a.ONEDRIVE.INSTANCE,loginUrl:u.a.MSACONFIG.INSTANCE+"?response_type=code&client_id="+u.a.MSACONFIG.CLIENT_ID+"&redirect_uri="+u.a.MSACONFIG.REDIRECT_URI+"&scope="+u.a.MSACONFIG.SCOPE,logoutUrl:u.a.MSACONFIG.LOGOUT_URI,photoUrl:u.a.MSACONFIG.PHOTO_URL,documentsUrl:u.a.RECENTS.ONEDRIVE_ENDPOINT}},this.lookupUserInfo=async function(e){return new Promise((e,r)=>{var n={oneDriveUrl:u.a.LINKS.APP.ONEDRIVE};t.get("$http")({method:"GET",url:u.a.MSACONFIG.USERINFO_URL,headers:{"X-UserType":u.a.USER_SERVICE_TYPE.MSA}}).then((function(t){var r=t.data;n.email=r.emails.account,n.cid=r.id,e(n)}),(function(){r("msaUser.Service.lookupUserInfo http request failed")}))})},this.getResourceForEndpoint=function(e){return u.a.MSACONFIG.SCOPE}}]).service("o365UserService",["$log","$injector","notification",function(e,t,r){this.type=u.a.USER_SERVICE_TYPE.O365,this.userType=u.a.USER_TYPE.O365,this.getConfig=function(){return{tokenUrl:u.a.O365CONFIG.INSTANCE+"token",params:{client_id:u.a.O365CONFIG.CLIENT_ID,client_secret:u.a.O365CONFIG.CLIENT_SECRET,redirect_uri:u.a.O365CONFIG.REDIRECT_URI,resource:u.a.O365CONFIG.GRAPH_RESOURCE},resource:u.a.O365CONFIG.GRAPH_RESOURCE,loginUrl:u.a.O365CONFIG.INSTANCE+"authorize?response_type=code&client_id="+u.a.O365CONFIG.CLIENT_ID+"&redirect_uri="+u.a.O365CONFIG.REDIRECT_URI+"&response_mode=query",logoutUrl:u.a.O365CONFIG.LOGOUT_URI,photoUrl:u.a.O365CONFIG.PHOTO_URL,documentsUrl:u.a.O365CONFIG.MRU_URL+u.a.RECENTS.FILTER}},this.getResourceForEndpoint=function(e){var t=this.getConfig().resource;if(a.a.isUndefinedOrNull(e))return t;for(var r in u.a.O365CONFIG.ENDPOINTS)if(u.a.O365CONFIG.ENDPOINTS.hasOwnProperty(r)&&e.indexOf(r)>-1){t=u.a.O365CONFIG.ENDPOINTS[r];break}return t},this.lookupUserInfo=async function(n){var i=function(t){var r={},n=function(t){var r=function(t){var r=/^([^.\s]*)\.([^.\s]+)\.([^.\s]*)$/.exec(t);if(!r||r.length<4)return e.error("The returned id_token is not parseable."),null;return{header:r[1],JWSPayload:r[2],JWSSig:r[3]}}(t);if(!r)return null;try{var n=function(e){if(e=e.replace(/-/g,"+").replace(/_/g,"/"),window.atob)return decodeURIComponent(escape(window.atob(e)));return null}(r.JWSPayload);return n?JSON.parse(n):(this._logstatus("The returned id_token could not be base64 url safe decoded."),null)}catch(t){e.error("The returned id_token could not be decoded: "+t.stack)}return null}(t);n&&n.hasOwnProperty("aud")&&(n.aud.toLowerCase()===u.a.O365CONFIG.CLIENT_ID.toLowerCase()?(n.hasOwnProperty("upn")?r.email=n.upn:n.hasOwnProperty("email")&&(r.email=n.email),n.hasOwnProperty("puid")&&(r.puid=n.puid),n.hasOwnProperty("tid")&&(r.tid=n.tid)):e.error("IdToken has invalid aud field"));return r}(n.id_token);const o=await async function(){var n={method:"GET",url:u.a.O365CONFIG.ONEDRIVE_URL,headers:{"X-UserType":u.a.USER_TYPE.O365}},i=t.get("userService");try{var o=await i.httpRequest(n);return o.webUrl?o.webUrl:Promise.reject("o365UserService.DiscoverServiceEndpoint - Invalid resource")}catch(n){return t.get("userService").clearToken(),r.show(u.a.NOTIFICATION.INVALIDSUBSCRIPTION),e.error("0365User.getOneDriveUrl failed: %s",n),null}}();i.oneDriveUrl=o;const a=await async function(){var r={method:"GET",url:u.a.O365CONFIG.SHAREPOINT_URL,headers:{"X-UserType":u.a.USER_SERVICE_TYPE.O365}},n=t.get("userService");try{var i=await n.httpRequest(r);return i.webUrl?i.webUrl:Promise.reject("No SharePoint info for user")}catch(t){return e.error("0365User.getSharePointUrl failed: %s",t),null}}();return i.sharePointUrl=a||u.a.LINKS.APP.SHAREPOINT_DEFAULT,i}}]).service("msidUserService",["$log","$injector","notification",function(e,t,r){const n=u.a.USER_SERVICE_TYPE.MSID;var i=void 0;const o="email openid profile user.read",a="https://graph.microsoft.com/v1.0/me/",s=new URL("https://login.microsoftonline.com/common/oauth2/").toString(),c=(new URL("https://login.live.com/oauth20_authorize.srf").toString(),new URL("nativeclient",s).toString()),l=new URL("v2.0/logoutsession",s).toString(),d=new URL("v2.0/authorize",s).toString(),f=(()=>{var e=new URL(d);return e.search=E({prompt:"select_account"}),e.toString()})();function p(){return i||(i=t.get("userService")),i}function E(e){const t={client_id:"e28ff72c-58a5-49ba-8125-42ec264d7cd0",response_type:"id_token token",redirect_uri:c,scope:o,response_mode:"fragment"};return new URLSearchParams(Object.assign({},t,e)).toString()}async function O(){var e={method:"GET",url:a,headers:{"X-UserType":n}},t={};try{t=function(e){for(const t in e)e.hasOwnProperty(t)&&t.match(/^@odata/i)&&delete e[t];return e}(await p().httpRequest(e))}catch(e){return Promise.reject("msidUser.fetchUserInfo failed: "+e)}return t}async function I(){var t={method:"GET",url:u.a.O365CONFIG.ONEDRIVE_URL,headers:{"X-UserType":n}};try{var i=await p().httpRequest(t);return i.webUrl?{oneDriveUrl:i.webUrl}:Promise.reject("o365UserService.DiscoverServiceEndpoint - Invalid resource")}catch(t){return r.show(u.a.NOTIFICATION.INVALIDSUBSCRIPTION),e.error("msidUser.fetchOneDriveUrl failed: "+JSON.stringify(t)),null}}async function m(){var t={method:"GET",url:"https://graph.microsoft.com/v1.0/me/drive",headers:{"X-UserType":n}};try{var r=await p().httpRequest(t),i=parseInt(r.quota.total)/1073741824;return i=Math.round(100*i)/100,e.info(`OneDrive quota: ${JSON.stringify(r.quota,null,"\t")} capacity: ${i}GB`),{driveQuota:r.quota.total,driveQuotaString:i+"GB"}}catch(e){return Promise.reject("msidUser.fetchOneDriveQuota failed: "+e)}}return{type:n,getConfig:function(){return{loginUrl:f,logoutUrl:l,photoUrl:"https://graph.microsoft.com/beta/me/photo/$value",userInfoUrl:a,documentsUrl:"https://graph.microsoft.com/v1.0/me/drive/recent"}},getResourceForEndpoint:function(t){if(!t)return o;const r={"https://graph.microsoft.com":{"/v1.0/me/":o,"/v1.0/me/drive/recent":"Files.ReadWrite.All"},"https://nleditor.osi.office.net":{"/NlEditor/":"https://nleditor.osi.office.net/NlEditor/instrumentation.write"}};try{const e=new URL(t);if(!r.hasOwnProperty(e.origin))return o;const n=r[e.origin],i=e.pathname;return n[Object.keys(n).reduce((e,t)=>i.startsWith(t)&&t.length>e.length?t:e)]}catch(t){return e.warning("msidUser.Service threw an exception: "+t),o}},lookupUserInfo:async function(e){const t=[O(),I(),m()];return(await Promise.all(t)).reduce((e,t)=>Object.assign(e,t))},requestAccessToken:async function(t,r){var i={scope:t,response_type:"token"};r&&r.email&&(i.login_hint=r.email);var o=E(i),a=new URL(d);a.search=o.toString();var s=await p().navigateToAuthEndpoint(a.href,n,!0);return s&&s.access_token?s:(e.info("failed to get token from iframe for resource "+t),Promise.reject("unable to retrieve result from "+a.href))}}}]).factory("userService",["$q","$log","$injector","storage","notification","msaUserService","o365UserService","msidUserService",function(e,t,r,n,i,o,s,l){async function d(e,r,n){var i={};if(!(i=await h(e)))return t.error("userService.acquireToken - Invalid type"),Promise.reject("Invalid userType");!n&&i.getResourceForEndpoint&&(n=i.getResourceForEndpoint(r));var o={};try{if((o=await y(r,n))&&o.access_token&&!b(o.expires_on))return t.debug(`Using cached token with resource:'${n}'${r?" for "+r:""} `),o.access_token;if(!(o=await async function(e,r){if(!e)return t.error("userService.requestAccessToken - Invalid type"),Promise.reject("Invalid userType");const n=await async function(){return C("refresh_token")}();if(n)return async function(e,r,n){if(!e)return t.error("userService.refreshAccessToken - Invalid type"),Promise.reject("Invalid userType");var i=e.getConfig();i.params.grant_type=u.a.OAUTH.REFRESH_TOKEN,i.params.resource=r,i.params.refresh_token=n;var o={method:"POST",url:i.tokenUrl,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:new URLSearchParams(i.params).toString()};return await f(o)}(e,r,n);const i=await O();var o=await L(i);if(e.requestAccessToken)var a=await e.requestAccessToken(r,o);return a}(i,n)))return Promise.reject("No tokens available");w(i,r,o)}catch(i){t.error(`userService.acquireToken - failed. reason: ${i}, userType: ${e}, endpoint: ${r}, resource: ${n}`)}return o&&o.access_token&&o.expires_on&&!b(o.expires_on)?o.access_token:null}async function f(e){if(!e)return Promise.reject("Invalid Request");var t=(new Error).stack,n=new Promise((n,i)=>{r.get("$http")(e).then(e=>{n(e.data)},r=>{i(`httpRequest failed for url: ${e.url} reason: ${r.statusText} stack:\n ${t}`)})});return await n}async function p(e){const r=e.type;var n=void 0,o=await h(r),a=!1;if(o){if(e.code){n=r.userType;try{a=!!await async function(e,r){if(!e)return t.error("userService.acquireTokenFromCode - Invalid type"),void Promise.reject("Invalid userService type");var n=e.getConfig();n.params.grant_type=u.a.OAUTH.AUTH_CODE,n.params.code=r;var i={method:"POST",url:n.tokenUrl,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:new URLSearchParams(n.params).toString()};const o=await f(i);return await w(e,e.getConfig().resource,o),await F(e,o),o.access_token}(o,e.code)}catch(e){n===u.a.USER_TYPE.O365&&i.show(u.a.NOTIFICATION.INVALIDSUBSCRIPTION)}}else e.id_token&&(n=await I(e.id_token)),e.access_token&&(await w(o,o.getConfig().userInfoUrl,e),n||(n=await O()),await F(o,e.id_token)),a=n!==u.a.USER_TYPE.NONE;return e.error&&("interaction_required"===e.error?v(await O(),!1):t.error(`userService.authenticate - authentication returned error: ${e.error} description: ${e.error_description} request: ${JSON.stringify(e)}`)),t.trackEvent("Authorization",{userType:n,serviceType:r,succeeded:a}),a?Promise.resolve():Promise.reject()}t.error("userService.authenticate - Invalid type")}async function E(){return Promise.all([n.remove("accessToken"),n.remove("refreshToken"),n.remove("userInfo"),n.remove("userType"),n.remove("identity")])}async function O(){return(await n.get("userType")).userType||u.a.USER_TYPE.NONE}async function I(e){var r="";if(Object.values(u.a.USER_TYPE).includes(e))r=e;else{var i=function(e){var r=e.scopes||e.scope;if(r&&r.includes("wl."))return{type:u.a.USER_TYPE.MSA};var n=e.id_token||e;if(!n)return{type:u.a.USER_TYPE.NONE};const i={"9188040d-6c67-4c5b-b112-36a304b66dad":{type:u.a.USER_TYPE.MSA,audience:"prod"},"4925308c-f164-4d2d-bc7e-0631132e9375":{type:u.a.USER_TYPE.MSA,audience:"ppe"},"72f988bf-86f1-41af-91ab-2d7cd011db47":{type:u.a.USER_TYPE.O365,audience:"prod",domain:"microsoft.com"},"f686d426-8d16-42db-81b7-ab578e110ccd":{type:u.a.USER_TYPE.O365,audience:"ppe",domain:"microsoft.com"}};try{const{header:e,payload:r}=function(e){var r=/^([^.\s]*)\.([^.\s]+)\.([^.\s]*)$/.exec(e);if(!r||r.length<4)return t.error("userService.parseJwtToken - The returned id_token is not parseable."),null;var n=JSON.parse(x(r[1])),i=JSON.parse(x(r[2]));return{header:n,payload:i}}(n);var o={tenant:r.tid};if(i.hasOwnProperty(o.tenant)){var a=i[o.tenant];o=Object.assign(o,a)}else o.type=u.a.USER_TYPE.O365;return o}catch(e){return{type:u.a.USER_TYPE.MSA}}}(e);r=i.type,delete i.type;var o={[r]:i},a=await _();U(a,o),await n.set({identity:a})}return r!==u.a.USER_TYPE.NONE&&await n.set({userType:r}),r}function m(e){e.state&&(e.state=decodeURIComponent(e.state));var[t,r,n]=e.state.split("|");return r&&(e.type=r),e}async function T(e,r,n){return new Promise(async(i,o)=>{if(a.a.isBackgroundContext()){const a=(e=new URL(e)).searchParams;for(const e of["state","nonce"]){var s=a.get(e);s||(s=M()),"state"===e&&r&&(s+="|"+r+"|"+u.a.APPINFO_NAME),a.set(e,s)}var l=void 0,d=void 0;function f(){if(c.a.runtime.onMessage.removeListener(E),l){var e=document.getElementById(l);e&&e.parentNode.removeChild(e)}}const I=a.get("state"),T=a.get("scope");t.info(`loading auth url:${e.href} ${n?"in iframe":""}`);var p=await L();function E(r,n,a){if(n.id===c.a.runtime.id){if(r.activity===u.a.ACTIVITY.AUTHORIZATION.NAME){var s=m(r);s||(t.error(`userService.listener - auth url:${e} returned null response `),o(s)),s.state!==I&&t.warn(`userService.listener - auth url:${e} mismatched state:${s.state}`),t[s.error?"error":"debug"](`userService.listener - auth response:${JSON.stringify(s)} received from url:${e}`),d&&clearTimeout(d),delete s.activity,f(),i(s)}}else t.debug("auth listener rejected invalid id: "+n.id)}if(p&&p.email&&!a.has("login_hint")&&a.set("login_hint",p.email),c.a.runtime.onMessage.addListener(E),n){a.set("prompt","none"),l="authFrame!"+T;const r=6e4;d=setTimeout(()=>{t.warn(`userService.authInFrame timed out waiting for ${e.toString()} after ${r} ms`),f(),o("Timed out waiting for response from iFrame")},r);var O=document.getElementById(l);O||((O=document.createElement("iframe")).setAttribute("id",l),O.style.visibility="hidden",O.style.position="absolute",O.style.width=O.style.height="0",O.style.border="0",O.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(O),O.src=e.toString())}else c.a.tabs.create({url:e.toString()})}else c.a.runtime.sendMessage({activity:"requestToken",data:{url:e,type:r,inIFrame:n}},e=>{i(e)})})}async function v(e,r=!0){!0===r&&E();var n=await h(e);if(n.handleLogin)return n.handleLogin();var i=n.getConfig().loginUrl;if(i)return T(i,n.type);t.error("userService.login - Invalid type")}async function g(){const e=await O();var r=await h(e);if(E(),r.handleLogout)await r.handleLogout();else{var n=r.getConfig().logoutUrl;if(!n)return void t.error("userService.logout - Invalid type");var i={method:"GET",url:n};await f(i)}t.debug("userService.logout - "+e)}async function S(e){return void 0!==e&&n.set({authNext:{override:e}}),N({noLogout:!0})}async function N(e){var r=new Date;const i=r.toUTCString();var o=await n.get("authNext");r=Math.round(r/1e3);var s=0;if(o.authNext&&o.authNext.lastCheck&&a.a.isNotUndefinedOrNull(o.authNext.flighted)&&(s=r-o.authNext.lastCheck,(!e||!0!==e.force)&&s<864e5&&o.authNext.flighted))return o.authNext.flighted;t.info("checkTransitionAuth time:"+i);var c=await(async()=>{var e={url:"https://nleditor.osi.office.net/NLEditor/api/V1/BrowserExtension",method:"POST",accept:"application/json",contentType:"application/json",headers:{"X-UserId":await async function(){var e=await n.get("deviceId");if(e.deviceId)return e.deviceId;var t=M();return await n.set({deviceId:t}),t}()},data:{AppId:"OfficeBX_Online"}},r={};try{r=await f(e)}catch(e){t.error("userService.checkAuthFlighting - Call to editor service failed. error:"+JSON.stringify(e))}var i=!1;if(r&&r.FeatureFlags&&r.FeatureFlags.authNext){var o=r.FeatureFlags.authNext;i="string"==typeof o?"true"===o.toLowerCase():!!o}return t.info("editor featureFlags.authNext returned:"+i),i})();if(await n.set({authNext:{flighted:c,lastCheck:r}}),o.authNext&&a.a.isNotUndefinedOrNull(o.authNext.override))return t.info("using authNext override from local storage."),o.authNext.override;var l=await C("service");c!==(l===u.a.USER_SERVICE_TYPE.MSID)&&(t.trackEvent("AuthNext",{elapsed:s,authNext:c,serviceType:l}),e&&!e.noLogout&&await g())}async function h(e){var r=null;return Object.values(u.a.USER_SERVICE_TYPE).includes(e)||(e=await async function(e){var t=await C("service",e);if(t)return t;if(t=u.a.USER_SERVICE_TYPE.NONE,await S())return u.a.USER_SERVICE_TYPE.MSID;switch(e){case u.a.USER_TYPE.MSA:t=u.a.USER_SERVICE_TYPE.MSA;break;case u.a.USER_TYPE.O365:t=u.a.USER_SERVICE_TYPE.O365}return t}(e)),-1!==e.indexOf(u.a.USER_SERVICE_TYPE.MSA)?r=o:-1!==e.indexOf(u.a.USER_SERVICE_TYPE.O365)?r=s:-1!==e.indexOf(u.a.USER_SERVICE_TYPE.MSID)?r=l:t.error("userService.getServiceProvider - Invalid type - "+e),r}async function _(){var e=await n.get("identity");return e&&e.identity?e.identity:{}}function U(e,r){for(var[n,i]of Object.entries(r))i&&(e[n]&&"none"!==e[n]&&"none"!==i?typeof i==typeof e[n]?Array.isArray(i)?i.forEach(t=>{e[n].indexOf(t)<0&&e[n].push(t)}):"object"!=typeof i?e[n]=i:U(e[n],i):t.warn(`skipping ${n} due to conflicting types`):e[n]=i)}function R(e){return new URL(e).origin}async function w(e,r,i){if(i.expires_in&&!i.expires_on&&(i.expires_on=a.a.getCurrentTime()+Number(i.expires_in)),r){var o=await O();if(o===u.a.USER_TYPE.NONE&&(o=await I(i)),o!==u.a.USER_TYPE.NONE){var s=decodeURIComponent(i.scope).toLowerCase().split(/[ +]/);for(const e of s){var c=e.match(/(^https:\/\/[.\w]*(?:\S+\/))/i);if(c){r=c[c.index];break}}r=R(r),i.resource&&i.resource!==r&&(t.info(`saveTokens ${r} does not match ${i.resource}`),r=i.resource);var l={[o]:{id_token:i.id_token,refresh_token:i.refresh_token,service:e.type,resources:{[r]:{access_token:i.access_token,expires_in:i.expires_in,expires_on:i.expires_on,scope:s}}}},d=await _();U(d,l),await n.set({identity:d})}else t.error("userService.saveTokens - unable to resolve userType")}else t.error("userService.saveTokens - endpoint not provided")}function A(e,t){if(!e)return!0;if(!t)return!1;Array.isArray(e)||(e=e.toLowerCase().split(/[ +]/));for(const r of e)if(!t.includes(r))return!1;return!0}async function y(e,r){if(e){e=R(e);try{var n=await C("resources");if(n[e]){var i=n[e];if(e===r)return i;if(i&&A(r,i.scope))return i;delete n[e]}for(const e in n)if(A(r,e.scope))return e;return null}catch(e){return null}}else t.error("userService.getAccessToken - endpoint not provided")}async function L(e){return C("userInfo",e)}async function C(e,t){t||(t=await O());var r=await _();return r[t]&&r[t][e]?r[t][e]:null}async function P(e,t,r){var i=await _(),o={};i[e]&&i[e].userInfo&&!r&&(o=i[e].userInfo),U(o,t),i[e]&&(i[e].userInfo=o,await n.set({identity:i}))}function b(e){var t=a.a.getCurrentTime();return!(e&&e>t+120)}async function F(e,t){var r=await O(),n=await e.lookupUserInfo(t);c.a.runtime.sendMessage({activity:u.a.ACTIVITY.USERINFO_AVAILABLE.NAME,data:n}),!n.email&&n.userPrincipalName&&(n.email=n.userPrincipalName),await P(r,n,!0),await D(e)}function x(e){return e=e.replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(window.atob(e)))}async function D(e){const r=e.type,n=await O();var i=e.getConfig().photoUrl;if(i){var o={method:"GET",url:i,responseType:"blob",headers:{"X-UserType":r}};try{const e=await f(o);t.trackEvent("UserService_GotServerPhoto",{userType:n});var a=new FileReader;a.onload=async()=>(P(n,{photo:a.result}),a.result),a.readAsDataURL(e)}catch(e){return null}}}function M(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=performance.now();const r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?r:3&r|8).toString(16)}))}return a.a.isBackgroundContext()&&c.a.runtime.onMessage.addListener((function(e,t,r){switch(e.activity){case u.a.ACTIVITY.LOGOUT.NAME:return g().then(()=>{r()}),!0;case u.a.ACTIVITY.AUTHENTICATION.NAME:return v(e.type).then(e=>{r(e)}),!0;case u.a.ACTIVITY.AUTHORIZATION.NAME:return t.id===c.a.runtime.id&&e.close&&(t.tab&&t.tab.id&&c.a.tabs.remove(t.tab.id),delete e.close),p(m(e)).then(()=>{r()}),!0;case u.a.ACTIVITY.REQUEST_TOKEN.NAME:return T(e.data.url,e.data.type,e.data.inIFrame).then(e=>{r(e)}),!0;default:return}})),window.useAuthNext=S,window.checkTransitionAuth=N,a.a.isBackgroundContext()&&async function(){t.debug("initCheckTransition"),await N(),setInterval(N,864e5)}(),{acquireToken:d,clearToken:E,isLoggedIn:async function(){var e=await n.get(["userType","identity"]);return e.identity&&e.userType&&e.userType!==u.a.USER_TYPE.NONE},getEndpointUrlForCurrentUser:async function(e){const t=await O();if(!t||t===u.a.USER_TYPE.NONE)return null;var r=await h(t);return r?r.getConfig()[e]:null},getUserType:O,getUserInfo:L,getUserPhoto:async function(){var e=await O();if(e===u.a.USER_TYPE.NONE)return t.warn("UserService.getUserPhoto: no signed-in user"),Promise.reject(u.a.RECENTS.ERROR.UNSUPPORTED_USER_TYPE);var r=await L(e);return r&&r.photo?(t.trackEvent("UserService_GotLocalPhoto",{userType:e}),r.photo):Promise.reject("No photo in local storage")},httpRequest:f,navigateToAuthEndpoint:T,saveUserInfo:P,waitForUserInfo:async function(e){return new Promise(async r=>{var n=await L(e);if(a.a.isNotUndefinedOrNull(n))return r(n);c.a.runtime.onMessage.addListener(s);var i=a.a.isExtensionInTestingMode()?u.a.TIMEOUT.USER_INFO_LOOKUP_TEST:u.a.TIMEOUT.USER_INFO_LOOKUP,o=setTimeout(()=>{t.warn(`userService.waitForUserInfo timed out after ${u.a.TIMEOUT.USER_INFO_LOOKUP} ms - ${e}`),l(),r(n)},i);function s(e){e.activity===u.a.ACTIVITY.USERINFO_AVAILABLE.NAME&&(l(),clearTimeout(o),r(e.data))}function l(){c.a.runtime.onMessage.removeListener(s)}})},getUserLicenseInfo:async function(){var e=await L();return["driveQuota","licenses"].reduce((t,r)=>(e[r]&&(t[r]=e[r]),t),{})},useAuthNext:S,authorize:p,getAccessToken:y,getPhotoFromServer:D,login:v,logout:g,lookupUserInfo:F}}]).name},55:function(e,t,r){e.exports=r(70)},56:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(4);var o="2c8ba5f543dc45cabca6a8903ae65ec0-17b4b4b1-0680-4459-8c45-b7c284ec277d-7329";i.AWTLogManager.initialize(o);const a=n.default.getBrowserAndVersion();a&&(i.AWTLogManager.setContext("DeviceInfo.BrowserName",a.browser),i.AWTLogManager.setContext("DeviceInfo.BrowserVersion",a.version));var s=i.AWTLogManager.getLogger(o);window.ariaLogger=s},7:function(e,t,r){"use strict";var n=r(3),i=r.n(n),o=r(2),a=r.n(o),s=(r(9),r(0)),c=r(1),u=r.n(c),l=function(e,t,r,n){var i=0;return{request:function(e){return u.a.isUndefinedOrNull(e.timeout)&&(e.timeout=s.a.TIMEOUT.DEFAULT_REQUEST),e},responseError:function(o){if(o)switch(o.status){case 0:t.debug("httpErrorResponseInterceptor - Request cancelled - "+o.config.url);break;case 401:t.info(`httpErrorResponseInterceptor - ${o.status} - ${o.config.url} - ${JSON.stringify(o.data)}`);break;case 400:if(u.a.isNotUndefinedOrNull(o.data)&&u.a.isNotUndefinedOrNull(o.data.error_codes)&&50001===o.data.error_codes[0]){t.info(`httpErrorResponseInterceptor -  Invalid AADSerivce - ${o.status} - ${JSON.stringify(o.data)}`);break}if(u.a.isNotUndefinedOrNull(o.data)&&u.a.isNotUndefinedOrNull(o.data.error_codes)&&50079===o.data.error_codes[0]){if(t.info(`httpErrorResponseInterceptor -  Interaction required - ${o.status} - ${JSON.stringify(o.data)}`),i<s.a.ERROR_RETRIES.HTTP_REQUEST)return i++,r((function(){return n.get("$http")(o.config)}),s.a.TIMEOUT.USER_INFO_LOOKUP);i=0}break;case 404:if(o.config.url.startsWith("https://graph.microsoft.com/v1.0/me/drive"))return e.resolve(o);default:t.error(`httpErrorResponseInterceptor - ${o.status} - ${o.config.url} - ${JSON.stringify(o.data)}`)}return e.reject(o)}}};var d=r(11);function f(e,t){function r(e){return e.length>8e3?e.substring(0,8e3):e}function n(e,r){try{t.trackTrace(e,r)}catch(e){}}function i(e,t,r,n,i){if(u.a.isBackgroundContext())try{var o=`[${(new Date).toLocaleString(void 0,{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})}] (${function(e){try{const t=new URL(location.href).origin+"/";e=e.toString().replace(t,"")}catch{}return e}(i)}) ${n?n+" ":""} ${e}`;console[t.toLowerCase()](o)}catch{}else a.a.runtime.sendMessage({activity:"log",severity:t,log:e,filename:n,stack:r})}function o(e){return"string"==typeof e?e:JSON.stringify(e)}var s=function(e,t){return function(){var a=[].slice.call(arguments),s=a[0],c=void 0;u.a.isExtensionInDevelopmentMode()&&(c=Error().stack);var l=r(o(s.message?s.message:s));new Promise(e=>{s.stack?e("string"==typeof s.stack?r(s.stack).split("\n"):s.stack):c?Object(d.mapStackTrace)(c,t=>{for(;t[0].match("logDecorator.js");)t.shift();e(t)},{}):e([])}).then(r=>{var o="",c=s.source||location;if(s.filename)o=s.filename;else for(var d of r){var f=d.match(/\b[\w.]+\b:\d+/g);if(f){o=f.pop();break}}i(l,t,r,o,c);var p=(new Date).toLocaleString(void 0,{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"});a[0]=`[${p}] ${o?o+" ":""}${t}: ${l}`,u.a.isExtensionInDevelopmentMode()&&e.apply(null,a),"DEBUG"!==t&&n(t,{message:l,stack:"ERROR"===t?r:""})})}};return e.debug=s(e.debug,"DEBUG"),e.info=s(e.info,"INFO"),e.warn=s(e.warn,"WARN"),e.error=s(e.error,"ERROR"),e.getEnabledSetting=function(){return t.getEnabledSetting()},e.setEnabledSetting=function(r){try{t.setEnabledSetting(r)}catch(t){e.error("setEnabledSetting error: "+t)}},e.trackEvent=function(r,n,i){try{t.trackEvent(r,n,i)}catch(t){e.error(`trackEvent error with eventName ${r}: ${t}`)}},e.trackTrace=n,e}window.dumpStorage=()=>{window.chrome&&window.chrome.storage.local.get(null,e=>{console.log(`result '${JSON.stringify(e,"\t")}'`)})};i.a.module("app.common",[]).config(["$httpProvider","$provide",function(e,t){t.decorator("$log",["$delegate","telemetry",f]),e.interceptors.push("httpInterceptor")}]).factory("storage",["$q","$log",function(e,t){return{get:function(r){var n=e.defer();return a.a.storage.local.get(r,(function(e){t.debug(`storage: get '${JSON.stringify(r)}', result '${JSON.stringify(e)}'`),n.resolve(e)})),n.promise},set:function(e){t.debug(`storage: set items '${JSON.stringify(e)}'`),a.a.storage.local.set(e)},remove:function(r){var n=e.defer();return a.a.storage.local.remove(r,(function(e){t.debug(`storage: remove '${JSON.stringify(r)}', result '${JSON.stringify(e)}'`),n.resolve(e)})),n.promise},clear:function(){var r=e.defer();return a.a.storage.local.clear((function(e){t.debug(`storage: clear result '${JSON.stringify(e)}'`),r.resolve(e)})),r.promise}}}]).factory("notification",["$log","localize",function(e,t){return{show:function(r){if(u.a.isBackgroundContext()){var n;if(void 0!==r.buttons&&null!==r.buttons){n=[];for(var i=0;i<r.buttons.length;++i)n[i]={},n[i].title=t.getLocalizedString(r.buttons[i].title),n[i].iconUrl=r.buttons[i].iconUrl}a.a.notifications.clear(r.id,(function(i){a.a.notifications.create(r.id,{iconUrl:"../assets/icon.png",imageUrl:r.imageUrl,message:t.getLocalizedString(r.message),priority:r.priority,progress:r.progress,title:"",type:r.type,buttons:n},(function(t){null==t&&e.error("CreateNotificationError")}))}))}else a.a.runtime.sendMessage({activity:s.a.ACTIVITY.NOTIFICATION.NAME,notification:r})}}}]).factory("httpInterceptor",["$q","$log","$timeout","$injector",l]).name},70:function(e,t,r){"use strict";r.r(t);var n=r(3),i=r.n(n),o=(r(14),r(56),r(7),r(24),r(1)),a=r.n(o),s=r(2),c=r.n(s),u=r(0),l=r(17);i.a.module("app.background",[]).controller("BackgroundController",["$window","$http","$q","$log","notification","storage","userService","fileService","copyPasteService",function(e,t,r,n,i,o,s,d,f){var p,E,O;s.isLoggedIn().then(e=>{e?a.a.setIcon(u.a.BROWSER_ICON.DEFAULT):a.a.setIcon(u.a.BROWSER_ICON.INACTIVE)}),o.get("webRedirect_disabled").then((function(e){p=a.a.isNotUndefinedOrNull(e.webRedirect_disabled)&&e.webRedirect_disabled})),c.a.windows.onFocusChanged.addListener((function(e){!async function(e){var t=new Date;if(E){var r=t-new Date(E.startTime);E.duration+=r}else{var i=await o.get("LastSession");i&&i.LastSession&&Number.isInteger(i.LastSession.duration)&&Date.parse(i.LastSession.startTime)?(E=i.LastSession).hasOwnProperty("start_time")&&(E.startTime=E.start_time,delete E.start_time):E={startTime:t,duration:0}}var a=new Date(E.startTime),s=new Date(t);s.setHours(0,0,0,0),a.setHours(0,0,0,0),(e||s-a)&&(n.trackEvent("Session",{startTime:E.startTime,duration:E.duration,minutes:Math.floor(E.duration/6e4)}),E.duration=0);E.startTime=t.toString(),o.set({LastSession:E})}()})),c.a.storage.onChanged.addListener((function(e,t){if(a.a.isNotUndefinedOrNull(e.webRedirect_disabled))p=e.webRedirect_disabled.newValue;else if(e.identity){e.identity.newValue?a.a.setIcon(u.a.BROWSER_ICON.DEFAULT):a.a.setIcon(u.a.BROWSER_ICON.INACTIVE)}})),c.a.webRequest.onSendHeaders.addListener((function(e){if("main_frame"===e.type)for(var t=0;t<e.requestHeaders.length;++t)if("Referer"===e.requestHeaders[t].name)return void(O=e.requestHeaders[t].value.indexOf("officeapps.live.com")>=0?null:e.tabId)}),{urls:["*://*/*.doc","*://*/*.doct","*://*/*.docx","*://*/*.dotx","*://*/*.odt","*://*/*.ppt","*://*/*.pot","*://*/*.pps","*://*/*.pptx","*://*/*.ppsx","*://*/*.odp","*://*/*.xls","*://*/*.xlsx","*://*/*.xlsm","*://*/*.xlsb","*://*/*.ods"]},["requestHeaders"]),c.a.webRequest.onHeadersReceived.addListener((function(e){if(!p&&"main_frame"===e.type&&!(a.a.isUndefinedOrNull(e.responseHeaders)||a.a.isUndefinedOrNull(O)||a.a.isUndefinedOrNull(e.tabId)||O!==e.tabId)){for(var t={},r=0;r<e.responseHeaders.length;++r)t[e.responseHeaders[r].name]=e.responseHeaders[r].value;if(!T(t,"Cache-Control")&&!T(t,"Pragma"))return t["Content-Type"]?u.a.FILE.OFFICE_MIME_TYPES[t["Content-Type"].toLowerCase()]?(n.trackEvent("OpenDocument_BrowserWebDocument"),o.get("displayWebDocRedirectNotification").then((function(e){(a.a.isUndefinedOrNull(e.displayWebDocRedirectNotification)||!0===e.displayWebDocRedirectNotification)&&i.show(u.a.NOTIFICATION.WEBDOCREDIRECT)})),{redirectUrl:"https://view.officeapps.live.com/op/view.aspx?src="+e.url}):void n.trackEvent("WebRequest_Header",{contentType:t["Content-Type"]}):void 0}}),{urls:["*://*/*.doc","*://*/*.doct","*://*/*.docx","*://*/*.dotx","*://*/*.odt","*://*/*.ppt","*://*/*.pot","*://*/*.pps","*://*/*.pptx","*://*/*.ppsx","*://*/*.odp","*://*/*.xls","*://*/*.xlsx","*://*/*.xlsm","*://*/*.xlsb","*://*/*.ods"]},["responseHeaders","blocking"]),c.a.webRequest.onBeforeRequest.addListener((function(e){if("main_frame"===e.type){n.trackEvent("OpenDocument_BrowserDragAndDrop");var t=e.tabId;return d.upload(e.url,u.a.FILE.ORIGIN.LOCAL_PATH,(function(e){a.a.isUndefinedOrNull(e)||m(e,t)})),{redirectUrl:u.a.LINKS.PROGRESSPAGE_URL}}}),{urls:["file:///*.doc","file:///*.doct","file:///*.docx","file:///*.dotx","file:///*.odt","file:///*.ppt","file:///*.pot","file:///*.pps","file:///*.pptx","file:///*.ppsx","file:///*.odp","file:///*.xlsx","file:///*.xlsm","file:///*.xlsb","file:///*.ods"]},["blocking"]),c.a.webRequest.onErrorOccurred.addListener((function(e){n.error("BackgroundWebRequestOnErrorOccured - "+e.error)}),{urls:["file:///*.doc","file:///*.doct","file:///*.docx","file:///*.dotx","file:///*.odt","file:///*.ppt","file:///*.pot","file:///*.pps","file:///*.pptx","file:///*.ppsx","file:///*.odp","file:///*.xlsx","file:///*.xlsm","file:///*.xlsb","file:///*.ods"]}),c.a.runtime.onInstalled.addListener((async function(e){var t=a.a.getManifest(),r=t?t.version:-1;if("install"===e.reason){n.trackEvent("AppInstalled",{appVersion:r}),c.a.runtime.getPlatformInfo(e=>{"cros"===e.os&&i.show(u.a.NOTIFICATION.SETDEFAULT)});var s=a.a.shouldShowEditorMaterial()?u.a.LINKS.SUPPORT_URL_EDITOR:u.a.LINKS.SUPPORT_URL;try{const e=await o.get(["deviceId","LastSession"]);if(Object.keys(e).length)return}catch(e){}m(s,null)}else"update"===e.reason&&(n.trackEvent("AppUpdated",{appVersion:r,previousVersion:e.previousVersion}),a.a.isNotUndefinedOrNull(window.localStorage.getItem(u.a.OAUTH.SERVICE_ID))&&(o.clear(),window.localStorage.clear()),o.get("userInfo").then((function(e){a.a.isNotUndefinedOrNull(e)&&a.a.isNotUndefinedOrNull(e.userInfo)&&(a.a.isNotUndefinedOrNull(e.userInfo.id)||a.a.isNotUndefinedOrNull(e.userInfo.profile))&&(o.clear(),window.localStorage.clear())})))})),c.a.notifications.onButtonClicked.addListener((function(e){switch(e){case u.a.NOTIFICATION.AUTOSAVE.id:o.set({displayAutoSaveNotification:!1});break;case u.a.NOTIFICATION.WEBDOCREDIRECT.id:o.set({displayWebDocRedirectNotification:!1})}})),c.a.notifications.onClicked.addListener((function(e){switch(e){case u.a.NOTIFICATION.FILEACCESS.id:c.a.tabs.create({url:u.a.LINKS.SETTINGS_URL});break;case u.a.NOTIFICATION.INVALIDSUBSCRIPTION.id:c.a.tabs.create({url:u.a.LINKS.OFFICE_URL})}})),c.a.runtime.onMessage.addListener((function(e,t,r){switch(e.eventId){case"telemetryEvent":case"newActivityTelemetryEvent":return}if(e.activity){switch(e.activity){case u.a.ACTIVITY.LOG.NAME:var o=void 0;if(t.url){var a=new URL(t.url);o=a.origin+a.pathname}return void n[e.severity.toLowerCase()]({message:e.log,stack:e.stack,filename:e.filename,source:o});case u.a.ACTIVITY.SSO.NAME:try{if(e.body.sender=t.url,0=="GetSupportedUrls".localeCompare(e.body.method,void 0,{sensitivity:"base"}))return g(S(),r),!0;c.a.runtime.sendNativeMessage(u.a.SSO.MESSAGE_CHANNEL,e.body,(function(e){var t={};n.debug("BrowserCore response: "+JSON.stringify(e)),e?e.status===u.a.SSO.RESPONSE_STATUS_FAIL?g(e,r):(t=Object.assign({status:u.a.SSO.RESPONSE_STATUS_SUCCESS,result:e}),n.trackEvent("SSO_SUCCESS"),r(t)):g({status:u.a.SSO.RESPONSE_STATUS_FAIL,code:u.a.SSO.RESPONSE_CODE_NO_SUPPORT,description:c.a.runtime.lastError.message},r)}))}catch(e){g({status:u.a.SSO.RESPONSE_STATUS_FAIL,code:u.a.SSO.RESPONSE_CODE_NO_SUPPORT,description:e.toString()},r)}return!0;case u.a.ACTIVITY.TELEMETRY.NAME:switch(e.command){case u.a.TELEMETRY.COMMAND.SET_DISABLED:n.setEnabledSetting(e.enabled),v(e.enabled);break;case u.a.TELEMETRY.COMMAND.TRACK_EVENT:n.trackEvent(e.eventName,e.properties,e.measurements);break;case u.a.TELEMETRY.COMMAND.TRACK_TRACE:n.trackTrace(e.message,e.properties)}break;case u.a.ACTIVITY.NOTIFICATION.NAME:i.show(e.notification);break;case u.a.ACTIVITY.AUTHENTICATION.NAME:case u.a.ACTIVITY.AUTHORIZATION.NAME:case u.a.ACTIVITY.LOGOUT.NAME:case u.a.ACTIVITY.REQUEST_TOKEN.NAME:return;default:return void n.warn("Unhandled activity:"+JSON.stringify(e))}n.debug("BackgroundController.onMessage: Processed activity "+e.activity)}})),a.a.isChrome()&&(Object(l.checkPermission)(["clipboardRead","clipboardWrite"],n).then(e=>{e&&c.a.runtime.onMessageExternal.addListener((function(e,t,r){switch(e.command){case u.a.COPY_PASTE.TEST:return f.handleTestCommand(e,t,r);case u.a.COPY_PASTE.PASTE:return f.handlePasteCommand(e,t,r);case u.a.COPY_PASTE.GET_CLIPBOARD_DATA:return f.handleGetClipboardDataCommand(e,t,r);case u.a.COPY_PASTE.GET_AVAILABLE_COMMANDS:return f.handleGetAvailableCommands(e,t,r);default:return!1}}))}),e.addEventListener("paste",f.onPasteEvent),Object(l.checkPermission)(["identity","identity.email"],n).then(e=>{e&&c.a.tabs.onUpdated.addListener((function(e,r,n){var i;!r.url||-1==(i=r.url).search(/^https:\/\/login\.microsoftonline\.com\/(common|.{8}-.{4}-.{4}-.{4}-.{12})\/oauth2\/authorize/)&&-1===i.indexOf("https://login.live.com/login.srf")||-1!==r.url.indexOf("login_hint")||-1!==r.url.indexOf("username")||c.a.identity.getProfileUserInfo((function(n){if(n&&n.email){var i=n.email,o={method:"GET",url:u.a.O365CONFIG.FEDERATED_URL+"?login="+i};t(o).then((function(t){var n=t.data;if(n&&"Federated"===n.NameSpaceType&&"live.com"!==n.DomainName){var o=-1===r.url.indexOf("https://login.live.com/login.srf")?"login_hint":"username",a=r.url;-1!==a.indexOf("?")?a+="&"+o+"="+i:a+="?"+o+"="+i,c.a.tabs.update(e,{url:a})}}),(function(){}))}}))}))}));function I(e,t){a.a.isUndefinedOrNull(e)?t(null):d.upload(e,u.a.FILE.ORIGIN.HTML5,(function(e){t(e)}))}function m(e,t){var i=r.defer();i.resolve(a.a.isNotUndefinedOrNull(t)?t:function(e){a.a.isUndefinedOrNull(e)&&(e=u.a.LINKS.PROGRESSPAGE_URL);var t=r.defer();return c.a.windows.getAll((function(r){0===r.length?c.a.windows.create({url:e,type:"normal"},(function(e){t.resolve(e.tabs[0].id)})):c.a.tabs.create({url:e},(function(e){t.resolve(e.id)}))})),t.promise}(e)),i.promise.then((function(t){a.a.isUndefinedOrNull(t)?n.warn("BackgroundController.openFileUrlInTab: tabIdPromise null or undefined"):c.a.tabs.update(t,{url:e})}))}function T(e,t){return e[t]&&-1!==e[t].toLowerCase().indexOf("private")}function v(e){if(a.a.isNotUndefinedOrNull(e)||(e=!0),a.a.isNotUndefinedOrNull(c.a.runtime.setUninstallURL)){var t=a.a.getManifest(),r=t?t.version:-1,n=a.a.isExtensionInDevelopmentMode()?u.a.LINKS.OFFICE_HOME_DEV_URL:u.a.LINKS.OFFICE_HOME_URL;e&&(n=u.a.LINKS.UNINSTALL+"?version="+r,n=a.a.isExtensionInDevelopmentMode()?n+"&isDebug=true":n,n=a.a.shouldShowEditorMaterial()?n+"&shouldShowEditorMaterial=true":n),c.a.runtime.setUninstallURL(n)}}function g(e,t){if(function(e){return e.ext&&e.ext.error===u.a.SSO.RESPONSE_CODE_INVALID}(e)){const e=S();n.trackEvent("SSO_FAIL",e),t(e)}else n.trackEvent("SSO_FAIL",e),t(e)}function S(){return{status:"Fail",code:"OSError",description:"Error processing request.",ext:{error:u.a.SSO.RESPONSE_CODE_INVALID}}}c.a.runtime.getPlatformInfo((function(e){"cros"===e.os&&Object(l.checkPermission)("fileBrowserHandler",n).then(e=>{e&&c.a.fileBrowserHandler.onExecute.addListener((function(e,t){!function(e,t){if(a.a.isUndefinedOrNull(e))t(null);else for(var r=0;r<e.length;++r)e[r].file((function(e){I(e,(function(e){t(e)}))}))}(t.entries,(function(e){a.a.isUndefinedOrNull(e)||m(e,null)}))}))})})),window.addEventListener("message",(function(e){0===c.a.runtime.getURL("").search(new RegExp(e.origin,"i"))?"[object File]"===Object.prototype.toString.call(e.data)?I(e.data,(function(e){a.a.isUndefinedOrNull(e)||m(e,null)})):n.error("BackgroundController.receiveMessage: Error processing message with event.data type "+Object.prototype.toString.call(e.data)):n.error("BackgroundController.receiveMessage: Error processing message with unrecognized origin "+e.origin)}),!1),n.getEnabledSetting().then((function(e){v(e)}))}]);var d=r(5),f=r(72),p=r(73);i.a.module("app.copypaste",[]).factory("copyPasteService",["$log","imageReader","$window",(e,t,r)=>new d.a(e,t,r)]).factory("fileReader",()=>new f.a).factory("imageReader",["$log","fileReader",(e,t)=>new p.a(e,t)]).name;i.a.module("app.file",[]).factory("fileService",["$http","$q","$log","localize","notification","storage","fileLoader","userService","sharePointFileService","oneDriveFileService",function(e,t,r,n,i,o,s,c,l,d){var f=u.a.USER_TYPE.NONE;function p(e,t){var n;c.getUserType().then((function(o){f=o,n=function(e){var t=null;switch(e){case u.a.USER_TYPE.O365:t=l;break;case u.a.USER_TYPE.MSA:t=d;break;default:i.show(u.a.NOTIFICATION.NOTSIGNEDIN),r.trackEvent("FileUserTypeError_UserNotSignedIn")}return t}(o),a.a.isUndefinedOrNull(n)?t(null):(r.trackEvent("FileServiceProviderUploadDocType",{extension:a.a.getFileExtension(e.name)}),i.show(u.a.NOTIFICATION.FILE_UPLOAD_IN_PROGRESS),n.doUpload(e,(function(e,n,o){a.a.isUndefinedOrNull(e)&&function(e,t){a.a.isUndefinedOrNull(t)||(415===t?i.show(u.a.NOTIFICATION.FILE_UPLOAD_FAILURE_UNSUPPORTED_MEDIA):502===t||503===t||509===t?i.show(u.a.NOTIFICATION.FILE_UPLOAD_FAILURE_SERVER):e&&(r.error(`fileService.doUpload - ${t} - ${JSON.stringify(e)}`),i.show(u.a.NOTIFICATION.FILE_UPLOAD_FAILURE_GENERIC)))}(n,o),t(e)})))}))}return{upload:function(e,t,n){if(a.a.isUndefinedOrNull(e)||t!==u.a.FILE.ORIGIN.HTML5&&t!==u.a.FILE.ORIGIN.LOCAL_PATH)return r.error(`fileService.upload(): Invalid argument: fileInfo: ${JSON.stringify(e)}, fileOrigin: ${t}`),void n(null);s.loadFile(e,t).then((function(e){p(e,(function(e){a.a.isUndefinedOrNull(e)?n(null):o.get("displayAutoSaveNotification").then((function(t){if(a.a.isUndefinedOrNull(t.displayAutoSaveNotification)||!0===t.displayAutoSaveNotification){var r=u.a.NOTIFICATION.AUTOSAVE;r.message=f===u.a.USER_TYPE.MSA?u.a.NOTIFICATION.AUTOSAVETOONEDRIVE:u.a.NOTIFICATION.AUTOSAVETOSHAREPOINT,i.show(r)}n(e)}))}))}),(function(e){!function(e){if(!a.a.isUndefinedOrNull(e))switch(e){case u.a.FILE.ERROR.FILE_SIZE_MAX_EXCEEDED:i.show(u.a.NOTIFICATION.FILE_MAX_SIZE_BYTE_LIMIT_REACHED);break;case u.a.FILE.ERROR.UNSUPPORTED_FILE_TYPE:i.show(u.a.NOTIFICATION.UNSUPPORTEDFILETYPE);break;default:r.error("fileService.loadFile - "+e),i.show(u.a.NOTIFICATION.FILE_UPLOAD_FAILURE_GENERIC)}}(e),n(null)}))}}}]).factory("fileLoader",["$http","$q","$log",function(e,t,r){return{loadFile:function(e,n){var i=t.defer();if(a.a.isUndefinedOrNull(e)||a.a.isUndefinedOrNull(n)&&n!==u.a.FILE.ORIGIN.HTML5&&n!==u.a.FILE.ORIGIN.LOCAL_PATH)return i.reject(`fileLoader.loadFile(): Invalid argument: fileInfo: ${JSON.stringify(e)}, fileOrigin: ${n}`),i.promise;if(n===u.a.FILE.ORIGIN.HTML5){if(e.size>u.a.FILE.MAX_SIZE_BYTE_LIMIT)return r.info(`fileLoader.loadFile(): Attempt to upload file with size exceeding limit - ${e.size} bytes`),i.reject(u.a.FILE.ERROR.FILE_SIZE_MAX_EXCEEDED),i.promise;(function(e){var r=t.defer();if(a.a.isUndefinedOrNull(u.a.FILE.SUPPORTED_FILE_TYPES[a.a.getFileExtension(e.name)]))return r.reject(u.a.FILE.ERROR.UNSUPPORTED_FILE_TYPE),r.promise;var n=new FileReader,i={};return i.name=encodeURI(e.name),n.onload=function(){i.content=new Int8Array(n.result),r.resolve(i)},n.readAsArrayBuffer(e),r.promise})(e).then((function(e){i.resolve(e)}),(function(e){i.reject(e)}))}else(function(e){var n=t.defer(),i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){if(4===i.readyState){if(200!==i.status&&0!==i.status)return r.error("fileLoader.loadFileFromPath(): XMLHttpRequestError at method loadFileFromPath - "+i.status),n.reject(u.a.FILE.ERROR.LOAD_FROM_PATH),n.promise;var t={};t.content=i.response,t.name=e.replace(/^.*[\\/]/,""),n.resolve(t)}},i.send(null),n.promise})(e).then((function(e){e.content?e.content.byteLength>u.a.FILE.MAX_SIZE_BYTE_LIMIT?(r.info(`fileLoader.loadFile(): Attempt to upload file with size exceeding limit - ${e.content.byteLength} bytes`),i.reject(u.a.FILE.ERROR.FILE_SIZE_MAX_EXCEEDED)):i.resolve(e):(r.error(),i.reject(u.a.FILE.ERROR.LOAD_FROM_PATH))}),(function(e){i.reject(e)}));return i.promise}}}]).service("oneDriveFileService",["$http","$log","localize",function(e,t,r){this.doUpload=function(n,i){var o={method:"PUT",url:u.a.ONEDRIVE.INSTANCE+"/drive/root:/"+encodeURIComponent(r.getLocalizedString("AppFolderName"))+"/"+n.name+":/content"+u.a.ONEDRIVE.QUERY_OPTION,headers:{"Content-Type":"application/octet-stream","X-UserType":u.a.USER_TYPE.MSA},data:n.content,transformRequest:[]};e(o).then((function(e){var r=e.data;t.debug(`oneDriveFileService.doUpload - ${e.status} - ${r.webUrl}`),i(r.webUrl)}),(function(e){i(null,null,e.statusText)}))}}]).service("sharePointFileService",["$http","$log","localize","userService",function(e,t,r,n){this.doUpload=async function(i,o){var s,c;i.name=(s=i.name,c=(new Date).toISOString().replace(/(\d+)-(\d+)-(\d+)T(\d+):(\d+):(\d+).+/,"_$1$2$3_$4$5$6."),s.replace(".",c));var l=await n.getUserInfo(u.a.USER_TYPE.O365);if(a.a.isUndefinedOrNull(l)||a.a.isUndefinedOrNull(l.oneDriveUrl))return t.error("sharePointFileService.doUpload - Invalid OneDriveUrl"),void o(null);var d={method:"PUT",url:u.a.O365CONFIG.UPLOAD_URL+encodeURIComponent(r.getLocalizedString("AppFolderName"))+"/"+i.name+":/content",headers:{"Content-Type":"application/octet-stream","X-UserType":u.a.USER_TYPE.O365},data:i.content,transformRequest:[]};e(d).then((function(e){var r,n,i=e.data,s=e.status;return a.a.isUndefinedOrNull(i.eTag)?(t.error("sharePointFileService.doUpload - Missing eTag"),void o(null,i,s)):(r=i.eTag.substring(1,i.eTag.indexOf(",")),a.a.isUndefinedOrNull(i["@microsoft.graph.downloadUrl"])?(t.error("sharePointFileService.doUpload - Missing downloadUrl"),void o(null,i,s)):(n=i["@microsoft.graph.downloadUrl"].replace(/download.aspx?.+/,"WopiFrame.aspx?sourcedoc="+r),t.debug(`sharePointFileService.doUpload - ${s} - ${n}`),void o(n)))}),(function(e){o(null,e.data,e.status)}))}}]).name;document.body.setAttribute("data-ng-controller","BackgroundController as ctrl"),document.documentElement.setAttribute("data-ng-app","app");t.default=i.a.module("app",["localization","app.common","app.diagnostics","app.user","app.file","app.background","app.copypaste"])},9:function(e,t){!function(){"use strict";var e=window.BrowserHandler;e||(e=chrome||browser),angular.module("localization",[]).factory("localize",["$filter",function(t){return{getLocalizedString:function(t){return e.i18n.getMessage(t)}}}]).filter("i18n",["localize",function(e){return function(t){return e.getLocalizedString(t)}}]).directive("i18n",["localize",function(e){var t={restrict:"EAC",updateText:function(t,r){var n=r.split("|");if(!(n.length<=1)){var i=e.getLocalizedString(n[0]);if(i){for(var o=1;o<n.length;o++){var a="{"+(o-1)+"}";i=i.replace(a,n[o])}t.text(i)}}},link:function(e,r,n){n.$observe("i18n",(function(e){t.updateText(r,n.i18n)}))}};return t}]).directive("i18nAttr",["localize",function(e){var t={restrict:"EAC",updateText:function(t,r){var n=r.split("|");if(!(n.length<2)){var i=e.getLocalizedString(n[0]);if(i){for(var o=2;o<n.length;o++){var a="{"+(o-2)+"}";i=i.replace(a,n[o])}t.attr(n[1],i)}}},link:function(e,r,n){n.$observe("i18nAttr",(function(e){t.updateText(r,e)}))}};return t}])}()}});